# iOS app spec: “На что я потрачу…” (удваивающийся бюджет)

Ниже — готовый промпт для GPT‑Codex, чтобы сгенерировать iOS‑приложение (SwiftUI) для игры “На что я потрачу…” с мультиязычностью, валютами, настройками, напоминаниями, streak/ачивками и “праздником” на максимуме.

---

## Prompt (copy/paste)

Ты — GPT‑Codex, действуй как ведущий iOS‑разработчик/продакт. Создай iOS приложение (SwiftUI) для игры “На что я потрачу…”.

### Цель игры
- Есть “День N” и сумма бюджета на день.
- Пользователь НЕ тратит деньги, а записывает “на бумаге” список воображаемых трат на эту сумму.
- На следующий день сумма = (вчерашняя сумма × 2), пока не достигнем лимита “максимум”.

### Платформа/стек
- iOS 17+ (или 16+, если не сильно усложняет), Swift 5.9+, SwiftUI.
- Локальное хранение данных: SwiftData или CoreData (выбери одно и обоснуй кратко).
- Локализация: String Catalogs (.xcstrings) + форматирование чисел/валют через Locale.
- Без внешних сервисов по умолчанию (офлайн first).

### Ключевые фичи
#### 1) Главный экран “Сегодня”
- Показывает текущий “День N”, сумму дня, валюту дня, прогресс до максимума.
- Кнопка “Заполнить траты” открывает экран ввода списка трат.
- Если день уже заполнен — показывает итог и список трат.

#### 2) Экран “Траты дня”
- Пользователь добавляет строки: (название, сумма, необязательная категория).
- Вверху: лимит дня (сумма дня), ниже: “Итого”, “Осталось”.
- Валидируй: нельзя превысить лимит дня (или разреши, но подсвети и не давай сохранить — выбери один вариант и опиши).
- Сохранение закрывает день как “заполненный”.

#### 3) История
- Список дней с датой, валютой, суммой дня, статусом (заполнен/пропущен).
- Открытие дня показывает детали.

#### 4) Настройки
- Язык приложения (in-app language switcher).
- Лимиты игры:
  - Стартовая сумма (для текущего языка/локали).
  - Максимальная сумма (для текущего языка/локали).
  - Поведение при достижении максимума (enum):
    - A) “Праздник и стоп” (по умолчанию): виртуальный приз + поздравление, игра ставится на паузу до ручного перезапуска.
    - B) “Сброс и заново”: после праздника начать заново со стартовой суммы на следующий день.
    - C) “Потолок”: сумма больше не растёт (остаётся максимальной), игра продолжается.
- Настройки напоминаний:
  - Время ежедневного напоминания.
  - Включить/выключить уведомления.

### Мультиязычность + валюта/лимиты, зависящие от языка
- Для каждого поддерживаемого языка задаются:
  - `currencyCode` (например: ru→RUB, en→USD, de→EUR и т.д.)
  - значения по умолчанию: стартовая сумма и максимальная сумма.
- При переключении языка:
  - Уже созданные дни ОСТАЮТСЯ в своей старой валюте и с оригинальными суммами (ничего не конвертируй задним числом).
  - Новые дни создаются в новой валюте.
  - Текущая “базовая” сумма для следующего нового дня должна быть “примерно по курсу” пересчитана в новую валюту.
- Требование к курсу (офлайн):
  - Сделай “Approx FX”: таблица приблизительных курсов между поддерживаемыми валютами, обновляемая вручную в Настройках (пользователь может поправить коэффициент).
  - При переключении языка сохрани “курс переключения” (`conversionRateUsed`) и используй его для вычисления новой текущей суммы.
  - Округление: суммы храни в minor units (центы/копейки) и округляй банковским или обычным правилом (выбери и зафиксируй).

### Напоминания (Local Notifications)
- Каждый день в заданное время отправляй локальное уведомление “Заполни список трат за день”.
- Уведомление должно учитывать, заполнен ли текущий день (если заполнен — не слать/или слать мягко “не забудь завтра”; выбери одно).
- Запрос разрешения на уведомления — аккуратно, с пояснением.

### Streak / депремирование / ачивки
- Веди streak: количество дней подряд, когда день был заполнен.
- Если пропущены 2 дня подряд (или “2 дня подряд не заполняют”) — применить “депремирование”:
  - Сбросить streak в 0.
  - Прогресс “цепочки” начинается заново со следующего заполненного дня.
- Ачивки:
  - За streak (3, 7, 14, 30…).
  - За “идеально заполненный день” (ровно уложился в лимит).
  - За достижение максимума.
- UI: экран “Ачивки” со списком и статусом (получена/в процессе).

### Праздник по умолчанию на максимуме
- При достижении максимума показать полноэкранный экран поздравления:
  - “виртуальный приз” (бейдж/трофей), конфетти-анимация (простая, без сторонних SDK).
  - Кнопки: “Перезапустить” (если выбран режим A или B), “Поделиться” (share sheet с текстом).

### Данные/модель
- Спроектируй модели данных так, чтобы:
  - `DayEntry` хранит: `dayIndex`, `date`, `currencyCode`, `dailyLimitMinor`, `status` (filled/missed), `conversionRateUsed`(optional), `items[]`
  - `SpendItem`: `title`, `amountMinor`, `category`(optional)
  - `Settings`: `languageCode`, `startAmountMinorByLanguage`, `maxAmountMinorByLanguage`, `currencyByLanguage`, `approxFxTable`, `reminderTime`, `maxBehavior`, `notificationsEnabled`
  - `Achievements`: definition + `earnedAt`(optional)
- Дни должны формироваться календарно (по локальной дате пользователя), а не “каждые 24 часа”.

### UX/качество
- Пустые состояния, понятные тексты, доступность (Dynamic Type, VoiceOver labels).
- Обработка смены часового пояса и смены даты.
- Без крашей при отказе в уведомлениях.

### Что нужно на выходе
- Полный Xcode проект, собирается и запускается.
- Минимум 2–3 локали (например: ru, en, de) с разными валютами и дефолтными лимитами.
- Небольшие unit tests для:
  - логики удвоения/перехода дня
  - логики конвертации при смене языка
  - streak reset при 2 пропусках
- Короткий README: как запустить, как тестировать, как добавлять новый язык/валюту/дефолты.

### Принципы
- Делай простую архитектуру (например, MVVM).
- Не усложняй сетью: курсы офлайн + ручная настройка.
- Будь аккуратен с форматированием валют по Locale.

### Сначала
1) Сформулируй краткий продукт-спек + список экранов.
2) Затем сразу генерируй/создавай проект и код.
3) В конце — как проверить сценарии вручную (checklist).


---

## Изменения требований (уточнено в ходе реализации)

- Дефолтные лимиты заданы как эквиваленты диапазона от `5 USD` до `1,000,000 USD`:
  - `en/USD`: старт `5`, максимум `1,000,000`
  - `de/EUR`: старт `4.6`, максимум `920,000`
  - `ru/RUB`: старт `500`, максимум `100,000,000`
- Дефолтные Approx FX коэффициенты предзаполнены (USD/EUR/RUB в обе стороны).
- Дефолтное время напоминания: `14:15`.
- Дефолтный язык приложения берется из системной локали (`ru/de/en`, иначе `en`).
- Поведение на максимуме оставлено в двух пользовательских вариантах:
  - `Сброс и заново`
  - `Потолок`
  - для каждого режима в UI показывается поясняющий хинт.
- Переключение языка должно применяться сразу (лейблы/названия экранов/настройки валютных лимитов обновляются немедленно).
- Обновление курса валют в настройках поддерживает загрузку из внешнего сервиса:
  - для `ru` обязательно загружается `USD -> RUB` (и дополнительно `EUR -> RUB`),
  - для `en`: `USD -> EUR`,
  - для `de`: `EUR -> USD`.
- Экран "Траты дня" поддерживает:
  - автосохранение черновика,
  - предустановленные и пользовательские категории,
  - удаление пользовательских категорий,
  - редактирование существующей траты по тапу,
  - удаление траты,
  - сохранение при превышении лимита до `+5%`.
